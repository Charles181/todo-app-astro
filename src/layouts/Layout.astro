---
import "../styles/global.css";

interface Props {
    title: string;
}

const { title } = Astro.props;
---

<!doctype html>
<html lang="es">
    <head>
        <meta charset="UTF-8" />
        <meta name="description" content="App de tareas familiar" />
        <meta name="viewport" content="width=device-width" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <meta name="generator" content={Astro.generator} />
        <title>{title}</title>
        <script is:inline>
            // Dark mode init
            if (
                localStorage.getItem("theme") === "dark" ||
                (!("theme" in localStorage) &&
                    window.matchMedia("(prefers-color-scheme: dark)").matches)
            ) {
                document.documentElement.classList.add("dark");
            } else {
                document.documentElement.classList.remove("dark");
            }
        </script>
    </head>
    <body
        class="bg-slate-50 dark:bg-slate-900 min-h-screen font-sans text-slate-900 dark:text-slate-100 transition-colors duration-300"
    >
        <header
            class="bg-indigo-600 dark:bg-indigo-900 text-white p-4 shadow-md sticky top-0 z-10 transition-colors"
        >
            <div class="container mx-auto flex justify-between items-center">
                <a
                    href="/"
                    class="text-xl font-bold tracking-tight hover:text-indigo-100 transition flex items-center gap-2"
                >
                    游 <span class="hidden sm:inline"
                        >Ayudapp: Santill치n L칩pez</span
                    >
                </a>

                <div class="flex items-center gap-4">
                    <!-- Dark Mode Toggle -->
                    <button
                        id="theme-toggle"
                        class="p-2 rounded-lg bg-indigo-500 dark:bg-indigo-800 hover:bg-indigo-400 dark:hover:bg-indigo-700 transition"
                    >
                        游깿
                    </button>

                    {
                        Astro.locals.user && (
                            <div class="flex items-center gap-3">
                                <a
                                    href="/profile"
                                    class="flex items-center gap-2 hover:bg-indigo-500 px-3 py-1 rounded-lg transition"
                                >
                                    <span class="text-xl">
                                        {Astro.locals.user.avatar || "游녻"}
                                    </span>
                                    <span class="font-medium hidden sm:block">
                                        {Astro.locals.user.name}
                                    </span>
                                </a>
                                <form action="/api/logout" method="POST">
                                    <button
                                        type="submit"
                                        class="bg-indigo-700 hover:bg-indigo-800 dark:bg-indigo-950 dark:hover:bg-indigo-900 px-3 py-1.5 rounded-lg text-sm font-bold transition"
                                    >
                                        Salir
                                    </button>
                                </form>
                            </div>
                        )
                    }
                </div>
            </div>
        </header>
        <main class="container mx-auto p-4 max-w-4xl">
            <slot />
        </main>
        <footer class="p-4 text-center text-slate-500 text-sm mt-8">
            &copy; {new Date().getFullYear()} Santill치n L칩pez - Ayudapp
        </footer>
        <script is:inline>
            (function () {
                const themeToggleBtn = document.getElementById("theme-toggle");
                if (themeToggleBtn) {
                    themeToggleBtn.addEventListener("click", () => {
                        if (
                            document.documentElement.classList.contains("dark")
                        ) {
                            document.documentElement.classList.remove("dark");
                            localStorage.setItem("theme", "light");
                        } else {
                            document.documentElement.classList.add("dark");
                            localStorage.setItem("theme", "dark");
                        }
                    });
                } else {
                    console.error("Theme toggle button not found");
                }
            })();
        </script>
    </body>
</html>
